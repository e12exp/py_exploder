default:
# see exploder configuration manual, page six for details.
 - {name: set, addr: 0x00000020, val: 0x10000000} # MBS Total dead time -> global dt
 - {name: set, addr: 0x00000080, val: 0x00000a64} # dead time
 - {name: set, addr: 0x00000081, val: 0x00000014} # output pulse length
 - {name: set, addr: 0x00000082, val: 0x00010001} # TS clock: on, src=internal, LEMO out: TTL
 # - {name: pulser3, freq: 1}

# master slave sfp
# M->S: 0: Event trigger
#       1: RO, T1
#       3: RO, T3
#       4: Reset
# S->M: 0: RO-Req
#       1: Proton
#       2: Proton-Veto

# Master <-> Overlord
# As M<->S, but without RO-Req or T1
# 1,2 are proton, veto received from sfp1
# 3,4 are proton, veto received from sfp2

slave:
 # uses bp0-7, sfp3, tbus, scaler0-3
 - require default
 # TBus -> SFP
 - name: bp0
   in:  [tbus0.4, tbus1.4]
   out: [sfp3.0, scaler0]
   label: RO-req
 - name: bp1
   in:  [tbus0.3, tbus1.3]
   out: [sfp3.1, scaler1]
   label: good proton
 - name: bp2
   in:  [tbus0.6, tbus1.6]
   out: [sfp3.2, scaler2]
   label: bad proton
 # SFP -> TBus
 - name: bp3
   in:  [sfp3.0]
   out: [tbusX.5, scaler3]
   label: validation to febex
 - name: bp4
   in:  [sfp3.1]
   out: [tbusX.0]
   label: Slave T1
 - name: bp5
   in:  [sfp3.3]
   out: [tbusX.2]
   label: Slave T3
 - name: bp15
   in: [sfp3.4]
   out: [scaler_rst0, scaler_rst1, scaler_rst2, scaler_rst3, scaler_rst4, scaler_rst5, scaler_rst6, scaler_rst7]
   label: slave scaler reset

master:
 - require slave # bp0-7, tbus, sfp3, scaler0-3
 # sfp0: link to overlord
 # sfp1-2: link to slaves
 # lemo out 7: Pexaria latch
 - name: dt0 # readout request => readout (T1)
   in:  [ sfp1.0, sfp2.0]
   out: [ mbs1,  sfp1.1, sfp2.1, lemo7, scaler4]
   label: Master T1
 - name: dt1 # Sync trigger (T3)
   in: [ sfp0.3 ]
   out: [ mbs3,  sfp1.3, sfp2.3, lemo7, scaler5 ]
   label: Master T3 (sync)
 # test: pulser 0 added to external trigger
 - { name: bp8,  in: [sfp0.0, pulser0], out: [ sfp1.0, sfp2.0 ], label: external }
 - { name: bp9,  in: [sfp1.1], out: [ sfp0.1 ], label: good proton from sfp1 }
 - { name: bp10, in: [sfp1.2], out: [ sfp0.2, scaler6 ], label: bad proton from sfp1 }
 - { name: bp11, in: [sfp2.1], out: [ sfp0.3 ], label: good proton from sfp2 }
 - { name: bp12, in: [sfp2.2], out: [ sfp0.4, scaler7 ], label: bad proton from sfp2 }
 - { name: bp13, in: [ sfp1.0, sfp2.0], out: [], label: Master RO Req }
 - { name: bp14, in: [sfp0.4], out: [ sfp1.4, sfp2.4 ], label: Master Scaler Reset } 

overlord:
 - require default
 # sfp 0: MES master exploder
 # sfp 1: WIX master exploder
 - { name: bp0, in: [sfp0.1], out: [lemo0, scaler0], label: MES upper protons }
 - { name: bp1, in: [sfp0.3], out: [lemo1, scaler1], label: MES lower protons }
 - { name: bp2, in: [sfp1.1], out: [lemo2] } # Wix upper
 - { name: bp3, in: [sfp1.3], out: [lemo3] } # Wix lower
 - { name: bp7, in: [sfp0.2, sfp0.4, sfp1.2, sfp1.4], out: [lemo7] } # bad proton
 - name: pulser1
   freq: 200
 - { name: bp8,  in: [lemo0, pulser1 ], out: [ sfp0.0, sfp1.0, scaler6 ], label: external }
 - { name: pulser0, freq: 100 }
 - { name: bp9,  in: [lemo3, pulser0 ], out: [ sfp0.3, sfp1.3, scaler7 ], label: sync trigger }
 - { name: pulser3, freq: 1 }
 - name: bp15
   in: [pulser3]
   out: [scaler_rst0, scaler_rst1, scaler_rst2, scaler_rst3, scaler_rst4, scaler_rst5, scaler_rst6, scaler_rst7, sfp0.4, sfp1.4 ]


--- # assign to id
butters: # messel
  9a:88:a3:2d:97:b9:0f:b2: master
  9c:e5:26:c3:fd:59:e2:b1: slave
kyle:
  foo: master
  bar: slave
wendy:
  9f:47:f1:06:fd:b7:9d:30: overlord
